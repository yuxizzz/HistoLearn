---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# HistoLearn: A R Package Interpreting and Visualizing Foundation Model Derived Histological Features

## Description:
The clinical practice of pathology involves tasks such as tumor detection and stage classification on hematoxylin and eosin (H&E) tissue images. With the advancement of AI 
and computational biology, many of these tasks can now be automated. Recently 
developed pathology foundation models, or general-purpose encoders, 
can process regions of  interest (ROIs) or whole-slide images (WSIs) and 
generate high-dimensional feature embeddings that summarize histological 
patterns. These embeddings can then serve as inputs for downstream analyses 
and predictive modeling, including classification and segmentation tasks (Chen et al., 2024).

HistoLearn provides a workflow for computational pathology that integrates downstream analysis (including interpretation, visualization, and modeling) of H&E embeddings generated from pathology foundation models. It enables users to load H&E embeddings with their class labels, perform dimensionality reduction, train classifiers, and evaluate performance. The package implements a simple pipeline combining principal component analysis (PCA) with either k-nearest neighbors (kNN) or logistic regression. This design is inspired by the common workflows used in pathology foundation models (Chen et al., 2024). HistoLearn offers an all-in-one framework for the interpretation and predictive modeling of high-dimensional histological embeddings. It fills the current gap in computational pathology where downstream workflows—PCA, visualization, and classification—are rarely packaged into a unified R pipeline. The accompanying Shiny app further enables users to explore embeddings and train models interactively, making these analyses accessible even to users without coding experience.

This package was developed under R 4.5.1 (2025-06-13) on macOS Tahoe 26.1 (aarch64-apple-darwin20).

## Installation

To install the latest version of the package:

```         
install.packages("devtools")
library("devtools")
devtools::install_github("yuxizzz/HistoLearn", build_vignettes = TRUE)
library("HistoLearn")
```

To run the shinyApp:
```
HistoLearn::run_histoLearn()
```
The example data for shinyApp can be found under `inst\extdata` folder.

## Overview:

Full tutorial is available on vignettes.
```         
ls("package:HistoLearn")
data(package = "HistoLearn")
browseVignettes("HistoLearn")
```

### Overview diagram

![Workflow overview](inst/extdata/workflow.png)
The workflow diagram is drawn using BioRender and the example H&E images are from Kather et al. (2018), The workflow diagram is drawn using BioRender and the example colorectal cancer H&E images are from Kather et al. (2018), where BACK represent class background, ADI represent class Adipose, DEB represent debris.

### Main functions

| Function | Description |
|---------------------------------|---------------------------------------|
| `load_embeddings(feature, label = NULL)` | Load features and labels into a `"histofeature"` object with validation. |
| `visualize_embeddings(input_data, dimensions = 2, type = "pca")` | Perform PCA projection and generate 2D or pairwise embedding plots. |
| `train_model(feature_embedding, dr = "pca", dr_k = 20, model = c("knn", "logistic"))` | Apply PCA reduction and train a k-NN classifier or a logistic regression classifier. Output a `histolearn` object for the final model. |
| `evaluate_model(trained_model, test_data)` | Evaluate predictions on a test set, visualize train and test confusion matrix, and output train and test accuracy. |
| `run_histoLearn()` | Launches the HistoLearn Shiny app for interactive visualization and model training. |

### Example Data

- **`train_embeddings`, `train_labels`** — Training set containing 9 human colorectal cancer tissue classes from Kather, Halama, and Marx (2018), preprocessed using the UNI pathology foundation model (Chen et al., 2024).

- **`test_embeddings`, `test_labels`** — Independent test set with the same structure as the training set for model evaluation.

- **`inst/extdata/subset_embeddings.csv`, `inst/extdata/subset_labels.csv`** — Example CSV files for the Shiny app, derived from the same colorectal cancer dataset and processed using the same UNI preprocessing pipeline.

## Contributions:

- `HistoLearn` was designed and implemented by Yuxi Zhu. The workflow draws inspiration from Chen et al. (2024). Yuxi identified the gap in existing R tools for histology-embedding analysis, curated and preprocessed datasets for demonstration, designed the overall workflow, determined when helper functions were needed, structured the function architecture, organized the Shiny app layout, and authored all documentation and vignettes.

- The example data and Shiny app demo datasets are derived from Kather et al. (2018) and were processed using the UNI pathology foundation model (Chen et al., 2024). The author performed all preprocessing steps to generate the example csv for shiny App and structured training/test datasets.

- The `stats` package is used for principal component analysis (PCA). The `caret` package is used for k-nearest neighbors (k-NN) model training (via `stats`), multinomial logistic regression (via `nnet`), and cross-validation, as well as for computing confusion matrices and accuracy metrics. The package uses `ggplot2` for visualization and `GGally` for multi-dimensional paired plots, while `lattice` is included to support underlying graphical components used by caret during resampling and model diagnostics. `knitr` is used to build vignette for the package.

-   ChatGPT-5 (OpenAI) was used solely to polish text and code, refactor code snippets upon request, generate initial templates for ShinyApp and the integration test, and summarize debugging output. An example of such usage includes prompts like “can you polish and refine the documentation?” or “can you turn this 
script into a helper function?”. All code and documentation for `load_embeddings()`, `visualize_embeddings()`, and `evaluate_model()` were fully written by Yuxi Zhu, and later polished with ChatGPT for phrasing and formatting improvements. The initial implementation of `train_model()` was written by Yuxi Zhu; ChatGPT assisted only in turning the specific code blocks selected by the author into helper functions (`train_logistic()`, `train_knn()`, and `reduce_dim()`) after the author identified the need for modularization. All unit tests were written by Yuxi Zhu, with ChatGPT helping summarize warnings and errors during debugging. A template for integration tests and an initial Shiny app were generated by ChatGPT, then reviewed, refined, and fully customized by Yuxi Zhu.

## References

Chen, R. J., Ding, T., Lu, M. Y., Williamson, D. F. K., Jaume, G., Song, A. H., Chen, B., Zhang, A., Shao, D., Shaban, M., Williams, M., Oldenburg, L., Weishaupt, L. L., Wang, J. J., Vaidya, A., Le, L. P., Gerber, G., Sahai, S., Williams, W., & Mahmood, F. (2024). *Towards a general-purpose foundation model for computational pathology*. **Nature Medicine, 30**(3), 850–862. https://doi.org/10.1038/s41591-024-02857-3

Kather, J. N., Halama, N., & Marx, A. (2018). *100,000 histological images of human colorectal cancer and healthy tissue* (v0.1) [Data set]. Zenodo. https://doi.org/10.5281/zenodo.1214456

Kuhn, M. (2008). Building predictive models in R using the caret package. *Journal of Statistical Software, 28*(5), 1–26. https://doi.org/10.18637/jss.v028.i05

OpenAI. (2025). *ChatGPT (GPT-5.1, February 2025 version)* (Large language model). https://chat.openai.com/

R Core Team. (2025). *R: A language and environment for statistical computing*. R Foundation for Statistical Computing. https://www.R-project.org/

Sarkar, D. (2008). *Lattice: Multivariate data visualization with R*. Springer. http://lmdvr.r-forge.r-project.org

Schloerke, B., Cook, D., Larmarange, J., Briatte, F., Marbach, M., Thoen, E., Elberg, A., & Crowley, J. (2025). *GGally: Extension to “ggplot2”* (Version 2.4.0) [R package]. https://doi.org/10.32614/CRAN.package.GGally

Venables, W. N., & Ripley, B. D. (2002). *Modern applied statistics with S* (4th ed.). Springer.

Wickham, H. (2016). *ggplot2: Elegant graphics for data analysis*. Springer.

## Acknowledgements:

This package was developed as part of an assessment for 2025 BCB410H:
Applied Bioinformatics course at the University of Toronto, Toronto,
CANADA. HistoLearn welcomes issues, enhancement requests, and other
contributions. To submit an issue, use the GitHub issues.
